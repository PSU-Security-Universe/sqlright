SET SESSION information_schema_stats_expiry=0;
CREATE TABLE t1 ( a INT, KEY (a) );
SHOW KEYS FROM t1;
ALTER TABLE t1 ALTER INDEX a INVISIBLE;
SHOW KEYS FROM t1;
ALTER TABLE t1 ALTER INDEX a VISIBLE;
SHOW KEYS FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, b INT );
CREATE INDEX a_invisible ON t1(a) INVISIBLE;
CREATE INDEX b_visible ON t1(a) VISIBLE;
CREATE INDEX a_b_invisible ON t1(a, b) INVISIBLE;
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, KEY (a) );
CREATE TABLE t2 ( a INT, KEY (a) INVISIBLE );
INSERT INTO t1 VALUES (1), (2), (3), (4), (5);
INSERT INTO t2 SELECT * FROM t1;
ANALYZE TABLE t1, t2;
EXPLAIN SELECT a FROM t1;
ALTER TABLE t1 ALTER INDEX a INVISIBLE;
EXPLAIN SELECT a FROM t1;
ALTER TABLE t1 ALTER INDEX a VISIBLE;
EXPLAIN SELECT a FROM t1;
EXPLAIN SELECT a FROM t2;
ALTER TABLE t2 ALTER INDEX a VISIBLE;
EXPLAIN SELECT a FROM t2;
DROP TABLE t1, t2;
CREATE TABLE t1 ( a INT, INDEX (a), b INT, INDEX (b) INVISIBLE );
SHOW INDEXES FROM t1;
ALTER TABLE t1 RENAME INDEX a TO a1;
ALTER TABLE t1 RENAME INDEX b TO b1;
SHOW INDEXES FROM t1;
ALTER TABLE t1 ALTER INDEX a1 INVISIBLE;
ALTER TABLE t1 ALTER INDEX b1 VISIBLE;
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, b INT, c INT, INDEX (a) VISIBLE, INDEX (b) INVISIBLE, INDEX (c) );
SHOW CREATE TABLE t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, PRIMARY KEY (a) INVISIBLE );
ALTER TABLE t1 ADD PRIMARY KEY (a) INVISIBLE;
CREATE TABLE t1( a INT );
ALTER TABLE t1 ADD CONSTRAINT pk PRIMARY KEY (a);
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1( a INT, PRIMARY KEY pk (a) );
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, KEY (a), b INT, KEY (b) INVISIBLE );
ALTER TABLE t1 RENAME INDEX no_such_index TO x;
ALTER TABLE t1 ALTER INDEX no_such_index INVISIBLE;
ALTER TABLE t1 ALTER INDEX a INVISIBLE, ALTER INDEX a VISIBLE;
ALTER TABLE t1 ALTER INDEX a INVISIBLE, ALTER INDEX b VISIBLE;
SHOW INDEXES FROM t1;
ALTER TABLE t1 RENAME INDEX a TO x, RENAME INDEX x TO a;
ALTER TABLE t1 RENAME INDEX a TO x, ALTER INDEX x INVISIBLE;
ALTER TABLE t1 RENAME INDEX a TO x, ALTER INDEX a VISIBLE;
ALTER TABLE t1 ALTER INDEX a VISIBLE, RENAME INDEX a TO x;
INSERT INTO t1 VALUES (1, 1), (2, 2), (3, 3);
ANALYZE TABLE t1;
ALTER TABLE t1 ALTER INDEX a INVISIBLE, ALGORITHM = COPY;
ANALYZE TABLE t1;
SHOW INDEXES FROM t1;
ALTER TABLE t1 ALTER INDEX a VISIBLE, ALGORITHM = INPLACE;
ANALYZE TABLE t1;
SHOW INDEXES FROM t1;
ALTER TABLE t1 ALTER INDEX a INVISIBLE, ALGORITHM = DEFAULT;
ANALYZE TABLE t1;
SHOW INDEXES FROM t1;
ALTER TABLE t1 ALTER INDEX a VISIBLE;
ANALYZE TABLE t1;
SHOW INDEXES FROM t1;
ALTER TABLE t1 ADD INDEX ab(a, b), ALTER INDEX ab INVISIBLE;
DROP TABLE t1;
CREATE TABLE t1 ( a INT, UNIQUE KEY (a) INVISIBLE );
CREATE TABLE t2 ( a INT UNIQUE );
CREATE TABLE t3 ( a INT NOT NULL, KEY (a) INVISIBLE, b INT PRIMARY KEY );
CREATE TABLE t4 ( a INT NOT NULL, UNIQUE KEY (a) INVISIBLE, b INT PRIMARY KEY AUTO_INCREMENT );
CREATE TABLE t5 ( a INT, b INT, c INT, UNIQUE KEY (a, b, c) INVISIBLE );
INSERT INTO t1 VALUES (1);
INSERT INTO t1 VALUES (1);
ALTER TABLE t2 ALTER INDEX a INVISIBLE;
INSERT INTO t2 VALUES (1);
INSERT INTO t2 VALUES (1);
INSERT INTO t3(a) VALUES (NULL);
INSERT INTO t4(a) VALUES (NULL);
INSERT INTO t4(a) VALUES (1);
INSERT INTO t4(a) VALUES (1);
INSERT INTO t5 VALUES (1, 2, 3);
INSERT INTO t5 VALUES (1, 2, 3);
DROP TABLE t1, t2, t3, t4, t5;
CREATE TABLE t1 ( a INT NOT NULL, UNIQUE KEY (a) );
ALTER TABLE t1 ALTER INDEX a INVISIBLE;
EXPLAIN SELECT * FROM t1;
SELECT * FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT NOT NULL, b INT NOT NULL PRIMARY KEY, UNIQUE KEY (a) INVISIBLE );
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT NOT NULL, b INT NOT NULL, UNIQUE KEY (a), UNIQUE KEY (b) INVISIBLE );
SHOW INDEXES FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( a INT NOT NULL, UNIQUE KEY (a) INVISIBLE );
CREATE TABLE t1 ( a INT NOT NULL, KEY (a) INVISIBLE, b INT NOT NULL UNIQUE );
CREATE TABLE t2 ( a INT PRIMARY KEY, b INT, INDEX(b) INVISIBLE);
ALTER TABLE t2 ALTER INDEX b VISIBLE;
DROP TABLE t1, t2;
CREATE TEMPORARY TABLE t1 ( a INT, KEY (a) INVISIBLE );
SHOW INDEXES FROM t1;
EXPLAIN SELECT a FROM t1;
DROP TABLE t1;
CREATE TABLE t1 ( fid INT NOT NULL AUTO_INCREMENT PRIMARY KEY, g GEOMETRY NOT NULL SRID 0, SPATIAL KEY(g) );
ANALYZE TABLE t1;
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(150 150, 150 150)'));
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(149 149, 151 151)'));
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(148 148, 152 152)'));
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(147 147, 153 153)'));
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(146 146, 154 154)'));
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(145 145, 155 155)'));
INSERT INTO t1 (g) VALUES (ST_GeomFromText('LineString(144 144, 156 156)'));
