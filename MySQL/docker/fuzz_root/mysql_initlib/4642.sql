CREATE TABLE ts (id INT UNSIGNED NOT NULL AUTO_INCREMENT PRIMARY KEY, ts TIMESTAMP);
SELECT @@GLOBAL.TIME_ZONE;
INSERT INTO ts(ts) VALUES ('2020-03-28 23:40:00+00:00'), ('2020-03-29 00:00:00+00:00'), ('2020-03-29 00:20:00+00:00'), ('2020-03-29 00:40:00+00:00'), ('2020-03-29 01:00:00+00:00'), ('2020-03-29 01:20:00+00:00'), ('2020-03-29 01:40:00+00:00'), ('2020-03-29 02:00:00+00:00'), ('2020-03-29 02:20:00+00:00');
SELECT id, ts, UNIX_TIMESTAMP(ts) FROM ts;
TRUNCATE TABLE ts;
INSERT INTO ts(ts) VALUES ('2020-10-24 23:40:00+00:00'), ('2020-10-25 00:00:00+00:00'), ('2020-10-25 00:20:00+00:00'), ('2020-10-25 00:40:00+00:00'), ('2020-10-25 01:00:00+00:00'), ('2020-10-25 01:20:00+00:00'), ('2020-10-25 01:40:00+00:00'), ('2020-10-25 02:00:00+00:00'), ('2020-10-25 02:20:00+00:00');
CREATE TABLE diffs (i INT, CONSTRAINT i CHECK (1200 = i) ENFORCED);
INSERT INTO diffs (SELECT unix_timestamp(ts) - LAG(unix_timestamp(ts)) OVER(ORDER BY id) AS diff FROM ts ORDER BY id);
SELECT COUNT(*) FROM diffs;
DROP TABLE diffs;
SELECT id, ts, UNIX_TIMESTAMP(ts) FROM ts;
DROP TABLE ts;
