SET @org_mode=@@sql_mode;
CREATE TABLE t1 (a int) ENGINE = InnoDB PARTITION BY HASH (a) PARTITIONS 2;
INSERT INTO t1 VALUES (0), (1), (2), (3);
CREATE VIEW v1 AS SELECT a FROM t1 PARTITION (p0);
SELECT * FROM t1;
SELECT * FROM v1;
INSERT INTO v1 VALUES (10),(11);
INSERT IGNORE INTO v1 VALUES (10),(11);
UPDATE IGNORE v1 SET a=11 WHERE a=2;
SELECT * FROM v1;
SELECT * from t1;
DROP TABLE t1;
DROP VIEW v1;
CREATE TABLE t1 (a int) ENGINE = InnoDB PARTITION BY LIST (a) (PARTITION x1 VALUES IN (2,5), PARTITION x2 VALUES IN (3));
INSERT INTO t1 VALUES (2), (3), (5);
INSERT INTO t1 VALUES (2),(4);
INSERT IGNORE INTO t1 VALUES (2),(4);
SELECT * FROM t1;
UPDATE t1 SET a=a+1;
UPDATE IGNORE t1 SET a=a+1;
SELECT * FROM t1;
DROP TABLE t1;
CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE = InnoDB;
CREATE TABLE t2 (b INT, FOREIGN KEY(b) REFERENCES t1(a)) ENGINE = InnoDB;
CREATE TABLE t3 (c INT PRIMARY KEY, FOREIGN KEY(c) REFERENCES t2(b)) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1), (2), (5);
INSERT INTO t2 VALUES (1);
INSERT INTO t3 VALUES (1), (2);
INSERT IGNORE INTO t3 VALUES (1), (2);
UPDATE t3 SET c=2 where c=1;
UPDATE IGNORE t3 SET c=2 where c=1;
DELETE FROM t1;
DELETE IGNORE FROM t1;
SELECT * FROM t1;
UPDATE t2 SET b=b+5;
UPDATE IGNORE t2 SET b=b+5;
SELECT * FROM t2;
DROP TABLE t3,t2,t1;
CREATE TABLE t1 (a INT) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1),(NULL),(2);
SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
ALTER TABLE t1 CHANGE a a INT NOT NULL;
SET sql_mode = default;
SELECT * FROM t1;
UPDATE IGNORE t1 SET a=NULL WHERE a=0;
SELECT * FROM t1;
DELETE FROM t1;
INSERT INTO t1 VALUES (NULL);
INSERT IGNORE INTO t1 VALUES (NULL);
SELECT * FROM t1;
INSERT IGNORE INTO t1 VALUES (NULL),(3);
SELECT * FROM t1;
DROP TABLE t1;
CREATE TABLE t1(a INT, b INT) ENGINE = InnoDB;
CREATE TABLE t2(a INT, b INT NOT NULL) ENGINE = InnoDB;
INSERT INTO t1 VALUES(1, NULL),(2,NULL);
INSERT INTO t2 VALUES (1,3), (2,4);
UPDATE IGNORE t1,t2 SET t2.b=NULL;
DROP TABLE t1,t2;
CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE = InnoDB;
CREATE TABLE t2 (b INT PRIMARY KEY, FOREIGN KEY(b) REFERENCES t1(a)) ENGINE = InnoDB;
CREATE TABLE t3 (c INT PRIMARY KEY) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1), (2);
INSERT INTO t2 VALUES (1);
INSERT INTO t3 VALUES (1),(2),(3),(4),(5);
CREATE TRIGGER post_update_t1 AFTER UPDATE ON t1 FOR EACH ROW BEGIN INSERT INTO t3 VALUES(4); END;
INSERT IGNORE INTO t1 VALUES(3);
SELECT * FROM t1;
UPDATE IGNORE t1 SET a=3 WHERE a=2;
SELECT * FROM t1;
DROP TRIGGER post_insert_t1;
DROP TRIGGER post_update_t1;
INSERT INTO t1 VALUES(2);
SELECT * FROM t3;
INSERT IGNORE INTO t1 VALUES(2),(3);
SELECT * FROM t1;
SELECT * FROM t3;
UPDATE IGNORE t1 SET a=3 WHERE a=2;
DROP TRIGGER post_insert_t1;
DROP TRIGGER post_update_t1;
DROP TABLE t2,t1,t3;
SET sql_mode=default;
CREATE TABLE t1 (a INT) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1),(NULL),(2);
DROP TABLE t1;
CREATE TABLE t1(a INT NOT NULL) ENGINE = InnoDB;
INSERT INTO t1 VALUES (NULL);
INSERT IGNORE INTO t1 VALUES(NULL);
SELECT * FROM t1;
INSERT INTO t1 VALUES (NULL),(3);
INSERT IGNORE INTO t1 VALUES (NULL),(1);
SELECT * FROM t1;
UPDATE t1 SET a=NULL WHERE a=0;
UPDATE IGNORE t1 SET a=NULL WHERE a=0;
SELECT * FROM t1;
DROP TABLE t1;
CREATE TABLE t1(a INT, b INT) ENGINE = InnoDB;
CREATE TABLE t2(a INT, b INT NOT NULL) ENGINE = InnoDB;
INSERT INTO t1 VALUES(1, NULL),(2,NULL);
INSERT INTO t2 VALUES (1,3), (2,4);
UPDATE t1,t2 SET t2.b=NULL;
UPDATE IGNORE t1,t2 SET t2.b=NULL;
DROP TABLE t1, t2;
CREATE TABLE t1 (a INT PRIMARY KEY) ENGINE = InnoDB;
CREATE TABLE t2 (b INT, FOREIGN KEY(b) REFERENCES t1(a)) ENGINE = InnoDB;
CREATE TABLE t3 (c INT PRIMARY KEY, FOREIGN KEY(c) REFERENCES t2(b)) ENGINE = InnoDB;
INSERT INTO t1 VALUES (1), (2), (5);
INSERT INTO t2 VALUES (1);
INSERT INTO t3 VALUES (1), (2);
INSERT IGNORE INTO t3 VALUES (1), (2);
UPDATE t3 SET c=2 where c=1;
UPDATE IGNORE t3 SET c=2 where c=1;
DELETE FROM t1;
DELETE IGNORE FROM t1;
SELECT * FROM t1;
UPDATE t2 SET b=b+5;
UPDATE IGNORE t2 SET b=b+5;
SELECT * FROM t2;
DROP TABLE t3,t2,t1;
