set big_tables=0;
flush status;
create table t1(a int, b int, c int);
insert into t1 values(null,null,null),(2,3,4);
WITH qn AS (SELECT a FROM t1) SELECT 1 FROM dual;
WITH qn AS (SELECT a FROM t1), qn2 as (select b from t1) SELECT 1 FROM dual;
WITH qn AS (SELECT a FROM t1), qn as (select b from t1) SELECT 1 FROM qn;
WITH qn AS (SELECT b as a FROM t1) SELECT qn.a, qn2.a  FROM qn, qn as qn2;
WITH qn AS (SELECT b as a FROM t1), qn2 AS (SELECT c FROM t1 WHERE a IS NULL or a>0) SELECT qn.a, qn2.c  FROM qn, qn2;
WITH qn AS (SELECT 10*a as a FROM t1), qn2 AS (SELECT 3*a FROM qn) SELECT * from qn2;
WITH qn AS (SELECT a FROM t1), qn2 AS (SELECT a FROM qn) SELECT * from qn2;
WITH qn AS (SELECT b as a FROM t1), qn2 AS (SELECT a FROM qn WHERE a IS NULL or a>0) SELECT qn.a, qn2.a  FROM qn, qn2;
EXPLAIN WITH qn AS (SELECT b as a FROM t1), qn2 AS (SELECT a FROM qn WHERE a IS NULL or a>0) SELECT qn.a, qn2.a  FROM qn, qn2;
WITH qn2 AS (SELECT a FROM qn WHERE a IS NULL or a>0), qn AS (SELECT b as a FROM t1) SELECT qn2.a  FROM qn2;
with qn1 as (with qn3 as (select * from qn2) select * from qn3), qn2 as (select 1) select * from qn1;
with qn0 as (select 1), qn1 as (select * from qn0), qn2 as (select 1), qn3 as (select 1 from qn1, qn2) select 1 from qn3;
explain with qn as (select 1) select 2;
with qn as (select 1) select 2;
WITH qn2 AS (SELECT a FROM qn WHERE a IS NULL or a>0), qn AS (SELECT b as a FROM qn2) SELECT qn.a  FROM qn;
WITH qn AS (SELECT a FROM qn) SELECT qn.a FROM qn;
WITH qn1 AS (SELECT a FROM qn3), qn2 AS (SELECT a FROM qn1), qn3 AS (SELECT a FROM t1), qn4 AS (SELECT a FROM qn2) SELECT a FROM qn4;
with qn as (select * from t1) select (select max(a) from qn);
SELECT (WITH qn AS (SELECT 10*a as a FROM t1), qn2 AS (SELECT 3*a AS b FROM qn) SELECT * from qn2 LIMIT 1) FROM t1;
SELECT * FROM (WITH qn AS (SELECT 10*a as a FROM t1), qn2 AS (SELECT 3*a AS b FROM qn) SELECT * from qn2) AS dt;
with qn as (with qn2 as (select "qn2" as a from t1) select "qn", a from qn2) select * from qn;
CREATE VIEW v AS WITH qn AS (SELECT 10*a as a FROM t1), qn2 AS (SELECT 3*a AS b FROM qn) SELECT * from qn2;
SELECT * FROM v;
DROP VIEW v;
CREATE TABLE t2 WITH qn AS (SELECT 10*a as a FROM t1), qn2 AS (SELECT 3*a AS b FROM qn) SELECT * from qn2;
SELECT * FROM t2;
INSERT INTO t2 WITH qn AS (SELECT 10*a as a FROM t1), qn2 AS (SELECT 3*a AS b FROM qn) SELECT * from qn2;
SELECT * FROM t2;
DROP TABLE t2;
explain with qn as (select * from t1 limit 10) select (select max(a) from qn where a=0), (select min(b) from qn where b=3);
with qn as (select * from t1 limit 10) select (select max(a) from qn where a=0), (select min(b) from qn where b=3);
create table qn select "base";
select * from qn;
with qn as (select "with") select * from qn;
WITH qn AS (select * from qn) select * from qn;
create view v as select * from qn;
select * from v;
with qn as (select "with") select * from v;
with qn as (select * from v) select * from qn;
drop table qn;
with qn as (select "with") select * from v;
with qn as (select * from v) select * from qn;
create table qn select "base" as a;
create function f() returns varchar(10) return (select * from qn);
select f();
with qn as (select "with") select f();
with qn as (select f()) select * from qn;
create temporary table qn select "tmp" as a;
select * from qn;
with qn as (select "with") select * from qn;
drop function f;
drop view v;
with qn as (select "with") select * from (select "dt") as qn;
WITH qn AS (select "outer" as a) SELECT (WITH qn AS (SELECT "inner" as a) SELECT a from qn), qn.a FROM qn;
with test.qn as (select "with") select * from test.qn;
select test.qn.a from (select "with" as a) qn;
with qn as (select "with") select * from qn;
with qn as (select "with") select * from test.qn;
with qn as (select "with" as a) select a from qn;
with qn as (select "with" as a) select qn.a from qn;
with qn as (select "with" as a) select test.qn.a from qn;
with qn as (select "with" as a) select a from test.qn;
with qn as (select "with" as a) select qn.a from test.qn;
with qn as (select "with" as a) select test.qn.a from test.qn;
drop temporary table qn;
with qn as (select "with" as a) select a from test.qn;
with qn as (select "with" as a) select qn.a from test.qn;
with qn as (select "with" as a) select test.qn.a from test.qn;
drop table qn;
with qn as (select "with" as a) select a from test.qn;
with qn as (select "with" as a) select qn.a from test.qn;
with qn as (select "with" as a) select test.qn.a from test.qn;
WITH qn AS (SELECT b as a FROM t1 UNION SELECT b+5 FROM t1), qn2 AS (SELECT a FROM qn WHERE a IS NULL or a>0) SELECT qn.a FROM qn UNION SELECT qn2.a FROM qn2 WHERE qn2.a>3;
with qn as (select "with" as a), with qn2 as (select "with" as a) select a from test.qn;
explain with qn as (select a from t1 order by 1) select a from qn;
explain with qn as (select a from t1 order by 1) select qn.a from qn, t1 as t2;
explain with qn as (select a from t1 order by 1 limit 10) select qn.a from qn, t1 as t2;
explain with qn as (select a from t1), qn2 as (select b from t1) select /*+ merge(qn) no_merge(qn2) */ qn.a,qn2.b from qn, qn2;
explain with qn as (select a from t1) select /*+ merge(qn) no_merge(qn2) */ qn2.a from qn, qn as qn2;
with qn as (select a, b from t1) select b from qn group by a;
with qn as (select a, b from t1 where a=b) select b from qn group by a;
with qn as (select a, sum(b) as s from t1 group by a) select s from qn group by a;
set @myvar= (with qn as (select a, sum(b) as s from t1 group by a) select s from qn group by a having s is not null);
select @myvar;
explain with cte as (select * from t1 as t2 limit 1) select * from t1 where t1.a in (select a+0 from cte);
with cte as (select * from t1 as t2 limit 1) select * from t1 where t1.a in (select a+0 from cte);
explain with cte as (select * from t1 as t2) select * from t1 where t1.a in (select a+0 from cte);
with cte as (select * from t1 as t2) select * from t1 where t1.a in (select a+0 from cte);
with qn () as (select 1) select * from qn, qn qn1;
with qn (foo, bar) as (select 1) select * from qn, qn qn1;
explain with qn (foo, bar) as (select 1, 2 from t1 limit 2) select * from qn, qn qn1;
with qn (foo, bar) as (select 1, 2 from t1 limit 2) select * from qn, qn qn1;
with qn (foo, bar) as (select 1 as col, 2 as coll from t1 limit 2) select * from qn, qn qn1;
with qn (foo, bar) as (select 1 as col, 2 as coll union select a,b from t1) select qn1.bar from qn qn1;
with qn (foo, bar) as (select a, b from t1 limit 2) select qn.bar,foo from qn;
create table t3 with qn (foo, bar) as (select a, b from t1 limit 2) select bar,foo from qn;
desc t3;
drop table t3;
with qn (foo, bar) as (select 1 from t1) select * from qn, qn qn1;
with qn (foo, bar) as (select 1, 2 from t1) select * from qn, qn qn1;
explain with qn (foo, bar) as (select 1, 2 from t1) select * from qn, qn qn1;
with qn (foo, bar) as (select 1 as col, 2 as coll from t1) select * from qn, qn qn1;
with qn (foo, bar) as (select a, b from t1) select qn1.bar,foo from qn qn1;
create table t3 with qn (foo, bar) as (select a, b from t1) select bar,foo from qn;
desc t3;
drop table t3;
with qn as (select 1,1) select * from qn;
with qn (foo, bar) as (select 1,1) select * from qn;
with qn as (select 1,1 from t1) select * from qn;
with qn (foo, bar) as (select 1,1 from t1) select * from qn;
with qn (foo, foo) as (select 1,2) select * from qn;
select * from (select '1', 1) dt(foo,bar);
select * from (select a,b from t1) dt(foo,bar);
select * from (select a from t1) dt(foo,bar);
create view v1 as with qn (foo, bar) as (select 1,1) select * from qn;
show create view v1;
show fields from v1;
