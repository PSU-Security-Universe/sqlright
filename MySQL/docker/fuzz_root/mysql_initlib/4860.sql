SET SESSION windowing_use_high_precision=FALSE;
CREATE TABLE t(i INT, li BIGINT, b VARBINARY(8), lb VARBINARY(24), d DOUBLE GENERATED ALWAYS AS (i*1.0));
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_OR(i) OVER w), HEX(BIT_OR(li) OVER w), HEX(BIT_OR(b) OVER w), HEX(BIT_OR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
ANALYZE TABLE t;
EXPLAIN FORMAT=JSON SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_OR(i) OVER w), HEX(BIT_OR(li) OVER w), HEX(BIT_OR(b) OVER w), HEX(BIT_OR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_XOR(i) OVER w), HEX(BIT_XOR(li) OVER w), HEX(BIT_XOR(b) OVER w), HEX(BIT_XOR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_AND(i) OVER w), HEX(BIT_AND(li) OVER w), HEX(BIT_AND(b) OVER w), HEX(BIT_AND(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_OR(i) OVER w), HEX(BIT_OR(li) OVER w), HEX(BIT_OR(b) OVER w), HEX(BIT_OR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_XOR(i) OVER w), HEX(BIT_XOR(li) OVER w), HEX(BIT_XOR(b) OVER w), HEX(BIT_XOR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_AND(i) OVER w), HEX(BIT_AND(li) OVER w), HEX(BIT_AND(b) OVER w), HEX(BIT_AND(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING);
INSERT INTO t(i, li, b, lb) VALUES (10, 10, x'0A', x'00000000000000000000000000000000000000000000000A');
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
DELETE FROM t WHERE i = 10;
INSERT INTO t(i, li, b, lb) VALUES (-1, -1, x'0A', x'00000000000000000000000000000000000000000000000A');
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
DELETE FROM t WHERE i = -1;
INSERT INTO t(i, li, b, lb) VALUES (4, 4, x'04', x'000000000000000000000000000000000000000000000004');
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (PARTITION BY LENGTH(b) ORDER BY i ROWS 2 PRECEDING);
DROP TABLE t;
CREATE TABLE t( c0004 LONGTEXT CHARACTER SET latin1 COLLATE latin1_bin GENERATED ALWAYS AS (_utf8mb4'1') VIRTUAL NOT NULL, d DOUBLE GENERATED ALWAYS AS (1.0)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
INSERT INTO t VALUES (), (), (), (), ();
SELECT c0004, BIT_AND(c0004) OVER w, BIT_OR(c0004)  OVER w, BIT_XOR(c0004) OVER w, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY c0004 ROWS BETWEEN 5 PRECEDING AND 3 PRECEDING);
SELECT c0004, BIT_AND(c0004) OVER w, BIT_OR(c0004)  OVER w, BIT_XOR(c0004) OVER w, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY c0004 ROWS BETWEEN 3 FOLLOWING AND 5 FOLLOWING);
DROP TABLE t;
CREATE TABLE t(i int, b VARBINARY(511), d DOUBLE GENERATED ALWAYS AS (i*1.0));
INSERT INTO t(i,b) VALUES (1, REPEAT(x'00', 511)), (1, REPEAT(x'FF', 511)), (1, REPEAT(x'77', 511)), (1, REPEAT(x'11', 511));
SELECT '---', HEX(BIT_OR(b) OVER w) AS `OR`, HEX(BIT_AND(b) OVER w) AS `AND`, HEX(BIT_XOR(b) OVER w) AS `XOR`, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS BETWEEN 1 PRECEDING AND CURRENT ROW);
DROP TABLE t;
CREATE TABLE t(i int, b VARBINARY(512), d DOUBLE GENERATED ALWAYS AS (i*1.0));
INSERT INTO t(i,b) VALUES (1, REPEAT(x'00', 512)), (1, REPEAT(x'FF', 512)), (1, REPEAT(x'77', 512)), (1, REPEAT(x'11', 512));
SELECT '---', HEX(BIT_OR(b) OVER w) AS `OR`, HEX(BIT_AND(b) OVER w) AS `AND`, HEX(BIT_XOR(b) OVER w) AS `XOR`, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS BETWEEN 1 PRECEDING AND CURRENT ROW);
DROP TABLE t;
CREATE TABLE t (id DECIMAL(3,1), b BINARY(9), d DOUBLE GENERATED ALWAYS AS (id*1.0));
INSERT INTO t(id, b) VALUES (5.0,0x000000000000000000), (7.0,0x070000000000000007), (6.0,0xFFFFFFFFFFFFFFFFFF), (5.5,0xFFFFFFFFFFFFFFFFFF);
SELECT id, id<=6 AS part, HEX(b), HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (PARTITION BY id<=6 ORDER BY id ROWS BETWEEN 1 PRECEDING AND CURRENT ROW);
DROP TABLE t;
SET SESSION windowing_use_high_precision=TRUE;
CREATE TABLE t(i INT, li BIGINT, b VARBINARY(8), lb VARBINARY(24), d DOUBLE GENERATED ALWAYS AS (i*1.0));
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_OR(i) OVER w), HEX(BIT_OR(li) OVER w), HEX(BIT_OR(b) OVER w), HEX(BIT_OR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
ANALYZE TABLE t;
EXPLAIN FORMAT=JSON SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_OR(i) OVER w), HEX(BIT_OR(li) OVER w), HEX(BIT_OR(b) OVER w), HEX(BIT_OR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_XOR(i) OVER w), HEX(BIT_XOR(li) OVER w), HEX(BIT_XOR(b) OVER w), HEX(BIT_XOR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_AND(i) OVER w), HEX(BIT_AND(li) OVER w), HEX(BIT_AND(b) OVER w), HEX(BIT_AND(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_OR(i) OVER w), HEX(BIT_OR(li) OVER w), HEX(BIT_OR(b) OVER w), HEX(BIT_OR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_XOR(i) OVER w), HEX(BIT_XOR(li) OVER w), HEX(BIT_XOR(b) OVER w), HEX(BIT_XOR(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING);
SELECT HEX(i), HEX(li), HEX(b), HEX(lb), HEX(BIT_AND(i) OVER w), HEX(BIT_AND(li) OVER w), HEX(BIT_AND(b) OVER w), HEX(BIT_AND(lb) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i DESC ROWS BETWEEN CURRENT ROW AND 2 FOLLOWING);
INSERT INTO t(i, li, b, lb) VALUES (10, 10, x'0A', x'00000000000000000000000000000000000000000000000A');
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
DELETE FROM t WHERE i = 10;
INSERT INTO t(i, li, b, lb) VALUES (-1, -1, x'0A', x'00000000000000000000000000000000000000000000000A');
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
DELETE FROM t WHERE i = -1;
INSERT INTO t(i, li, b, lb) VALUES (4, 4, x'04', x'000000000000000000000000000000000000000000000004');
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS 2 PRECEDING);
SELECT HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (PARTITION BY LENGTH(b) ORDER BY i ROWS 2 PRECEDING);
DROP TABLE t;
CREATE TABLE t( c0004 LONGTEXT CHARACTER SET latin1 COLLATE latin1_bin GENERATED ALWAYS AS (_utf8mb4'1') VIRTUAL NOT NULL, d DOUBLE GENERATED ALWAYS AS (1.0)) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;
INSERT INTO t VALUES (), (), (), (), ();
SELECT c0004, BIT_AND(c0004) OVER w, BIT_OR(c0004)  OVER w, BIT_XOR(c0004) OVER w, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY c0004 ROWS BETWEEN 5 PRECEDING AND 3 PRECEDING);
SELECT c0004, BIT_AND(c0004) OVER w, BIT_OR(c0004)  OVER w, BIT_XOR(c0004) OVER w, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY c0004 ROWS BETWEEN 3 FOLLOWING AND 5 FOLLOWING);
DROP TABLE t;
CREATE TABLE t(i int, b VARBINARY(511), d DOUBLE GENERATED ALWAYS AS (i*1.0));
INSERT INTO t(i,b) VALUES (1, REPEAT(x'00', 511)), (1, REPEAT(x'FF', 511)), (1, REPEAT(x'77', 511)), (1, REPEAT(x'11', 511));
SELECT '---', HEX(BIT_OR(b) OVER w) AS `OR`, HEX(BIT_AND(b) OVER w) AS `AND`, HEX(BIT_XOR(b) OVER w) AS `XOR`, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS BETWEEN 1 PRECEDING AND CURRENT ROW);
DROP TABLE t;
CREATE TABLE t(i int, b VARBINARY(512), d DOUBLE GENERATED ALWAYS AS (i*1.0));
INSERT INTO t(i,b) VALUES (1, REPEAT(x'00', 512)), (1, REPEAT(x'FF', 512)), (1, REPEAT(x'77', 512)), (1, REPEAT(x'11', 512));
SELECT '---', HEX(BIT_OR(b) OVER w) AS `OR`, HEX(BIT_AND(b) OVER w) AS `AND`, HEX(BIT_XOR(b) OVER w) AS `XOR`, SUM(d) OVER w AS dsum FROM t WINDOW w AS (ORDER BY i ROWS BETWEEN 1 PRECEDING AND CURRENT ROW);
DROP TABLE t;
CREATE TABLE t (id DECIMAL(3,1), b BINARY(9), d DOUBLE GENERATED ALWAYS AS (id*1.0));
INSERT INTO t(id, b) VALUES (5.0,0x000000000000000000), (7.0,0x070000000000000007), (6.0,0xFFFFFFFFFFFFFFFFFF), (5.5,0xFFFFFFFFFFFFFFFFFF);
SELECT id, id<=6 AS part, HEX(b), HEX(BIT_AND(b) OVER w), SUM(d) OVER w AS dsum FROM t WINDOW w AS (PARTITION BY id<=6 ORDER BY id ROWS BETWEEN 1 PRECEDING AND CURRENT ROW);
DROP TABLE t;
