CREATE TABLE t1(i INT) ENGINE MYISAM;
RENAME TABLE t1 TO tt1;
RENAME TABLE tt1 TO tt1tt1;
RENAME TABLE tt1tt1 TO ttt1ttt1ttt1ttt1_xyz;
RENAME TABLE ttt1ttt1ttt1ttt1_xyz TO tttttttttttttttt1_abc;
RENAME TABLE tttttttttttttttt1_abc TO t1;
DROP TABLE t1;
SET @old_lock_wait_timeout= @@lock_wait_timeout;
SET @old_lock_wait_timeout= @@lock_wait_timeout;
CREATE TABLE t0 (m INT) ENGINE=MyISAM;
CREATE TABLE t1 (i INT) ENGINE=InnoDB;
CREATE TABLE t2 (j INT) ENGINE=InnoDB;
CREATE TABLE t3 (k INT) ENGINE=InnoDB;
CREATE TABLE t4 (l INT) ENGINE=InnoDB;
LOCK TABLES t1 WRITE, t2 WRITE, t3 WRITE, t0 WRITE;
RENAME TABLES t0 TO t00, t1 TO t01, t2 TO t4;
SELECT * FROM t0;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
SELECT * FROM t00;
SELECT * FROM t01;
SELECT * FROM t4;
SET @@lock_wait_timeout= 1;
SELECT * FROM t0;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM t00;
SELECT * FROM t01;
SELECT * FROM t4;
UNLOCK TABLES;
DROP TABLES t0, t1, t2, t3, t4;
CREATE TABLE t1 (i INT);
CREATE DATABASE mysqltest;
LOCK TABLES t1 WRITE;
RENAME TABLE t1 TO mysqltest.t1;
INSERT INTO mysqltest.t1 VALUES (1);
SELECT * FROM t1;
SET @@lock_wait_timeout= 1;
SELECT * FROM mysqltest.t1;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM test.t1;
SET @@lock_wait_timeout= 1;
ALTER DATABASE mysqltest CHARACTER SET latin1;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
UNLOCK TABLES;
DROP TABLE mysqltest.t1;
CREATE TABLE t1 (i INT) ENGINE=InnoDB;
CREATE TABLE t2 (j INT) ENGINE=InnoDB;
CREATE TABLE t3 (k INT);
CREATE TABLE t4 (l INT) ENGINE=MyISAM;
LOCK TABLES t1 WRITE, t2 WRITE;
RENAME TABLES t1 TO mysqltest.t1, t2 TO t3;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM mysqltest.t1;
SELECT * FROM t3;
SET @@lock_wait_timeout= 1;
SELECT * FROM t1;
SELECT * FROM t2;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM mysqltest.t1;
SELECT * FROM t3;
ALTER DATABASE mysqltest CHARACTER SET latin1;
UNLOCK TABLES;
LOCK TABLES t4 WRITE, t1 WRITE;
RENAME TABLES t4 TO mysqltest.t4, t1 TO t3;
SELECT * FROM t4;
SELECT * FROM t1;
SELECT * FROM mysqltest.t4;
SELECT * FROM t3;
SET @@lock_wait_timeout= 1;
SELECT * FROM t4;
SELECT * FROM t1;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM mysqltest.t4;
SELECT * FROM t3;
ALTER DATABASE mysqltest CHARACTER SET latin1;
UNLOCK TABLES;
DROP TABLES t1, t2, t3, t4;
DROP DATABASE mysqltest;
