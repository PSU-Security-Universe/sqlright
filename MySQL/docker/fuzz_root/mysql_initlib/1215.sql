SET sql_mode = 'NO_ENGINE_SUBSTITUTION';
SET GLOBAL innodb_default_row_format=compact;
CREATE TABLE t1 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT=COMPACT PARTITION BY HASH (id) PARTITIONS 2;
CREATE TABLE t2 LIKE t1;
ALTER TABLE t2 REMOVE PARTITIONING;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t2;
CREATE TABLE t2 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t1, t2;
CREATE TABLE t1 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB PARTITION BY HASH (id) PARTITIONS 2;
CREATE TABLE t2 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT = COMPACT;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t1, t2;
CREATE TABLE t1 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB PARTITION BY HASH (id) PARTITIONS 2;
CREATE TABLE t2 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t1, t2;
CREATE TABLE t1 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT = REDUNDANT PARTITION BY HASH (id) PARTITIONS 2;
CREATE TABLE t2 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT = REDUNDANT;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t1, t2;
CREATE TABLE t1 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB PARTITION BY HASH (id) PARTITIONS 2;
CREATE TABLE t2 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT = REDUNDANT;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t1, t2;
CREATE TABLE t1 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT = COMPACT PARTITION BY HASH (id) PARTITIONS 2;
CREATE TABLE t2 ( id int(11) NOT NULL AUTO_INCREMENT, year year DEFAULT NULL, modified timestamp NOT NULL DEFAULT '0000-00-00 00:00:00', PRIMARY KEY (id) ) ENGINE=InnoDB ROW_FORMAT = REDUNDANT;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
SHOW CREATE TABLE t1;
SHOW CREATE TABLE t2;
SELECT TABLE_NAME, TABLE_TYPE, ENGINE, ROW_FORMAT, CREATE_OPTIONS FROM INFORMATION_SCHEMA.TABLES WHERE TABLE_SCHEMA = 'test' AND TABLE_NAME IN ('t1', 't2');
DROP TABLE t1, t2;
CREATE TABLE t1_1 ( `col1` int(11) DEFAULT NULL, `col2` int(11) DEFAULT NULL, `col3` int(11) DEFAULT NULL, `col4` text, `col5` varchar(500) GENERATED ALWAYS AS (substr(`col4`,1,500)) VIRTUAL, `col6` text GENERATED ALWAYS AS (substr(`col4`,1,500)) VIRTUAL ) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci /*!50100 PARTITION BY RANGE ((`col1` * 2)) (PARTITION p0 VALUES LESS THAN (128) ENGINE = InnoDB, PARTITION p1 VALUES LESS THAN (256) ENGINE = InnoDB, PARTITION p2 VALUES LESS THAN (384) ENGINE = InnoDB, PARTITION p3 VALUES LESS THAN MAXVALUE ENGINE = InnoDB) */;
CREATE TABLE temp25058 AS SELECT * FROM t1_1 WHERE 1 <> 1;
SHOW CREATE TABLE temp25058;
SELECT * FROM temp25058;
ALTER TABLE t1_1 ALGORITHM DEFAULT , LOCK SHARED , EXCHANGE PARTITION p2 WITH TABLE temp25058;
SHOW CREATE TABLE temp25058;
SELECT * FROM temp25058;
DROP TABLE temp25058;
DROP TABLE t1_1;
CREATE TABLE t1 (a INT NOT NULL, b TIME NOT NULL DEFAULT '00:00:00') ENGINE=InnoDB PARTITION BY HASH (a) PARTITIONS 2;
CREATE TABLE t2 (a INT) ENGINE=InnoDB;
ALTER TABLE t1 EXCHANGE PARTITION p1 WITH TABLE t2;
DROP TABLE t1, t2;
CREATE TABLE t1 (s1 INT PRIMARY KEY) ENGINE=InnoDB;
CREATE TABLE t2 (s1 INT, FOREIGN KEY (s1) REFERENCES t1 (s1)) ENGINE=InnoDB;
INSERT INTO t1 VALUES (1),(2),(3);
INSERT INTO t2 VALUES (1),(2),(3);
CREATE TABLE t3 (s1 INT PRIMARY KEY) ENGINE=InnoDB PARTITION BY LIST (s1) (PARTITION p1 VALUES IN (1,2,3));
ALTER TABLE t3 EXCHANGE PARTITION p1 WITH TABLE t1;
DROP TABLE t2, t1, t3;
CREATE TABLE t (a INT, b VARCHAR(55), PRIMARY KEY (a));
CREATE TABLE tp (a INT, b VARCHAR(55), PRIMARY KEY (a)) PARTITION BY RANGE (a) (PARTITION p0 VALUES LESS THAN (100), PARTITION p1 VALUES LESS THAN MAXVALUE);
CREATE TABLE tsp (a INT, b VARCHAR(55), PRIMARY KEY (a)) PARTITION BY RANGE (a) SUBPARTITION BY HASH(a) (PARTITION p0 VALUES LESS THAN (100) (SUBPARTITION sp0, SUBPARTITION sp1), PARTITION p1 VALUES LESS THAN MAXVALUE (SUBPARTITION sp2, SUBPARTITION sp3));
INSERT INTO t VALUES (1, "First value"), (3, "Three"), (5, "Five"), (99, "End of values");
INSERT INTO tp VALUES (2, "First value"), (10, "Ten"), (50, "Fifty"), (200, "Two hundred, end of values"), (61, "Sixty one"), (62, "Sixty two"), (63, "Sixty three"), (64, "Sixty four"), (161, "161"), (162, "162"), (163, "163"), (164, "164");
INSERT INTO tsp VALUES (2, "First value"), (10, "Ten"), (50, "Fifty"), (200, "Two hundred, end of values"), (61, "Sixty one"), (62, "Sixty two"), (63, "Sixty three"), (64, "Sixty four"), (161, "161"), (162, "162"), (163, "163"), (164, "164");
SHOW CREATE TABLE t;
SHOW CREATE TABLE tp;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tp EXCHANGE PARTITION p0 WITH TABLE t;
SHOW CREATE TABLE t;
SHOW CREATE TABLE tp;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tp EXCHANGE PARTITION p0 WITH TABLE t;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tp EXCHANGE PARTITION p1 WITH TABLE t;
SHOW CREATE TABLE t;
SHOW CREATE TABLE tp;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tp EXCHANGE PARTITION p0,p1 WITH TABLE t IGNORE;
ALTER TABLE tp EXCHANGE PARTITION p0,p1 WITH TABLE t;
ALTER TABLE tp EXCHANGE PARTITION p0 WITH TABLE (t,t2);
ALTER TABLE tp EXCHANGE PARTITION p0 WITH TABLE t,t2;
ALTER TABLE tp EXCHANGE PARTITION non_existent WITH TABLE t;
ALTER TABLE tsp EXCHANGE PARTITION p0 WITH TABLE t;
ALTER TABLE tsp EXCHANGE PARTITION sp0 WITH TABLE tp;
SHOW CREATE TABLE t;
SHOW CREATE TABLE tp;
SHOW CREATE TABLE tsp;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tp EXCHANGE PARTITION p0 WITH TABLE t;
SHOW CREATE TABLE t;
SHOW CREATE TABLE tp;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tp EXCHANGE PARTITION p0 WITH TABLE t;
SHOW CREATE TABLE t;
SHOW CREATE TABLE tp;
SELECT * FROM t;
SELECT * FROM tp;
ALTER TABLE tsp EXCHANGE PARTITION sp1 WITH TABLE t;
