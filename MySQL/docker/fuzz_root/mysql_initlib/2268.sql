SET @saved_binlog_format= @@SESSION.binlog_format;
drop table if exists t_34455;
create table t_34455 ( a int not null, foreign key (a) references t3 (a) on delete set default match full);
create table t_34455 ( a int not null, foreign key (a) references t3 (a) on delete set default on delete set default);
create table t_34455 (a int not null);
alter table t_34455 add foreign key (a) references t3 (a) on delete set default on delete set default);
alter table t_34455 add foreign key (a) references t3 (a) on update set default on update set default);
drop table t_34455;
SET @@foreign_key_checks= 0;
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY (b) REFERENCES non(a));
ALTER TABLE t1 ADD FOREIGN KEY (b) REFERENCES non(a);
DROP TABLE t1;
CREATE TABLE t1(a INT PRIMARY KEY);
CREATE TABLE t2(a INT PRIMARY KEY, b INT, FOREIGN KEY (b) REFERENCES t1(a));
DROP TABLE t1;
DROP TABLE t2;
SET @@foreign_key_checks= 1;
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY (b) REFERENCES non(a));
CREATE TABLE t1(a INT PRIMARY KEY, b INT REFERENCES non(a));
SHOW CREATE TABLE t1;
ALTER TABLE t1 ADD FOREIGN KEY (b) REFERENCES non(a);
DROP TABLE t1;
CREATE TABLE t1(a INT PRIMARY KEY);
CREATE TABLE t2(a INT PRIMARY KEY, b INT, FOREIGN KEY (b) REFERENCES t1(a));
DROP TABLE t1;
DROP TABLE t2, t1;
SET @@foreign_key_checks= DEFAULT;
CREATE TABLE t1(a INT PRIMARY KEY);
CREATE TABLE t2(a INT PRIMARY KEY, b INT);
ALTER TABLE t2 ADD CONSTRAINT name567890123456789012345678901234567890123456789012345678901234 FOREIGN KEY name567890123456789012345678901234567890123456789012345678901234 (b) REFERENCES t1(a);
SHOW CREATE TABLE t2;
SELECT CONSTRAINT_NAME FROM INFORMATION_SCHEMA.KEY_COLUMN_USAGE WHERE REFERENCED_TABLE_NAME = 't1';
DROP TABLE t2;
CREATE TABLE t2(a INT PRIMARY KEY, b INT);
ALTER TABLE t2 ADD FOREIGN KEY name5678901234567890123456789012345678901234567890123456789012345 (b) REFERENCES t1(a);
ALTER TABLE t2 ADD CONSTRAINT name5678901234567890123456789012345678901234567890123456789012345 FOREIGN KEY (b) REFERENCES t1(a);
DROP TABLE t2;
CREATE TABLE t2(a INT PRIMARY KEY, b INT UNIQUE);
ALTER TABLE t2 ADD FOREIGN KEY name5678901234567890123456789012345678901234567890123456789012345 (b) REFERENCES t1(a);
ALTER TABLE t2 ADD CONSTRAINT name5678901234567890123456789012345678901234567890123456789012345 FOREIGN KEY (b) REFERENCES t1(a);
DROP TABLE t2;
DROP TABLE t1;
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY(b) REFERENCES name5678901234567890123456789012345678901234567890123456789012345.t2(a));
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY(b) REFERENCES name5678901234567890123456789012345678901234567890123456789012345(a));
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY(b) REFERENCES t2(name5678901234567890123456789012345678901234567890123456789012345));
SET @@foreign_key_checks= 0;
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY(b) REFERENCES name5678901234567890123456789012345678901234567890123456789012345.t2(a));
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY(b) REFERENCES name5678901234567890123456789012345678901234567890123456789012345(a));
CREATE TABLE t1(a INT PRIMARY KEY, b INT, FOREIGN KEY(b) REFERENCES t2(name5678901234567890123456789012345678901234567890123456789012345));
SET @@foreign_key_checks= DEFAULT;
SET @@foreign_key_checks= 1;
CREATE TABLE t1(c1 INT PRIMARY KEY);
CREATE TABLE t2(c1 INT, FOREIGN KEY (c1) REFERENCES t1(c1));
ALTER TABLE t2 RENAME TO t3;
SHOW CREATE TABLE t3;
INSERT INTO t3 VALUES(1);
ALTER TABLE t3 RENAME TO t4, ALGORITHM= INPLACE;
SHOW CREATE TABLE t4;
INSERT INTO t4 VALUES(1);
ALTER TABLE t4 RENAME TO t5;
SHOW CREATE TABLE t5;
INSERT INTO t5 VALUES(1);
RENAME TABLE t5 to t6;
SHOW CREATE TABLE t6;
INSERT INTO t6 VALUES(1);
DROP TABLE t6, t1;
CREATE TABLE t1(a INT PRIMARY KEY);
CREATE TABLE t2(a INT, b INT, FOREIGN KEY(a) REFERENCES t1(a));
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
ALTER TABLE t2 ADD FOREIGN KEY(b) REFERENCES t1(a);
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
ALTER TABLE t2 DROP FOREIGN KEY t2_ibfk_1;
ALTER TABLE t2 ADD FOREIGN KEY(a) REFERENCES t1(a);
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
ALTER TABLE t2 RENAME TO t3;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't3' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't3' ORDER BY constraint_name;
ALTER TABLE t3 RENAME TO t4, ALGORITHM= INPLACE;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't4' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't4' ORDER BY constraint_name;
ALTER TABLE t4 RENAME TO t5;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't5' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't5' ORDER BY constraint_name;
RENAME TABLE t5 TO t6;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't6' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't6' ORDER BY constraint_name;
DROP TABLE t6;
CREATE TABLE `t6` ( `a` int(11) DEFAULT NULL, `b` int(11) DEFAULT NULL, KEY `b` (`b`), KEY `a` (`a`), CONSTRAINT `t6_ibfk_2` FOREIGN KEY (`b`) REFERENCES `t1` (`a`), CONSTRAINT `t6_ibfk_3` FOREIGN KEY (`a`) REFERENCES `t1` (`a`) ) ENGINE=InnoDB DEFAULT CHARSET=latin1;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't6' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't6' ORDER BY constraint_name;
RENAME TABLE t6 TO t2;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
ALTER TABLE t2 DROP FOREIGN KEY t2_ibfk_2, DROP FOREIGN KEY t2_ibfk_3;
ALTER TABLE t2 ADD FOREIGN KEY(a) REFERENCES t1(a);
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
ALTER TABLE t2 ADD CONSTRAINT t3_ibfk_2 FOREIGN KEY(b) REFERENCES t1(a);
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
RENAME TABLE t2 TO t3;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't3' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't3' ORDER BY constraint_name;
RENAME TABLE t3 TO t4;
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't4' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't4' ORDER BY constraint_name;
DROP TABLE t4;
CREATE TABLE t2(a INT, b INT);
ALTER TABLE t2 ADD CONSTRAINT t2_ibfk_1 FOREIGN KEY(a) REFERENCES t1(a);
ALTER TABLE t2 ADD FOREIGN KEY(b) REFERENCES t1(a);
SELECT constraint_name FROM information_schema.referential_constraints WHERE table_name = 't2' ORDER BY constraint_name;
SELECT constraint_name FROM information_schema.table_constraints WHERE table_name = 't2' ORDER BY constraint_name;
