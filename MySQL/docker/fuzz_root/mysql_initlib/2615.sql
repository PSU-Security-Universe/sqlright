DROP TABLE IF EXISTS t1,t2;
CREATE TABLE t1 ( pk MEDIUMINT NOT NULL AUTO_INCREMENT, a INT NOT NULL, b INT NOT NULL, c INT NOT NULL, d INT NOT NULL, PRIMARY KEY pk (pk), KEY idx_a (a), KEY idx_b (b), KEY idx_c (c), KEY idx_d (d) );
INSERT INTO t1(a,b,c,d) VALUES ( RAND()*5, RAND()*5, RAND()*5, RAND()*5 );
INSERT INTO t1(a,b,c,d) SELECT 6,6,6,6 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT 6,6,6,6 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT 6,6,6,6 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT 6,6,6,6 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT 6, RAND()*5, RAND()*5,  RAND()*5 FROM t1 LIMIT 3;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, 6, RAND()*5,  RAND()*5 FROM t1 LIMIT 3;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5, 6,  RAND()*5 FROM t1 LIMIT 3;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, 6 FROM t1 LIMIT 3;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
INSERT INTO t1(a,b,c,d) SELECT RAND()*5, RAND()*5,  RAND()*5, RAND()*5 FROM t1;
ANALYZE TABLE t1;
EXPLAIN UPDATE t1 SET a=2 WHERE b=6 AND c=6 ;
SELECT COUNT(*), SUM(a) FROM t1 WHERE b=6 AND c=6  ;
UPDATE t1 SET a=2 WHERE b=6 AND c=6 ;
SELECT COUNT(*), SUM(a) FROM t1 WHERE b=6 AND c=6 ;
EXPLAIN UPDATE t1 SET a=2 WHERE b=6 AND c=6 AND d=6;
SELECT COUNT(*), SUM(a) FROM t1 WHERE b=6 AND c=6 AND d=6;
UPDATE t1 SET a=2 WHERE b=6 AND c=6 AND d=6;
SELECT COUNT(*), SUM(a) FROM t1 WHERE b=6 AND c=6 AND d=6;
EXPLAIN UPDATE t1 SET c=6 WHERE d=6 AND a IS NOT NULL AND b=6;
SELECT COUNT(*), SUM(c) FROM t1 WHERE d=6 AND a IS NOT NULL AND b=6;
UPDATE t1 SET c=6 WHERE d=6 AND a IS NOT NULL AND b=6;
SELECT COUNT(*), SUM(c) FROM t1 WHERE d=6 AND a IS NOT NULL AND b=6;
EXPLAIN UPDATE t1 SET b=0 WHERE d=6 AND a=6  AND c <> 6;
SELECT COUNT(*), SUM(b) FROM t1 WHERE d=6 AND a=6  AND c <> 6;
UPDATE t1 SET b=0 WHERE d=6 AND a=6  AND c <> 6;
SELECT COUNT(*), SUM(b) FROM t1 WHERE d=6 AND a=6  AND c <> 6;
EXPLAIN UPDATE t1 SET a=100 WHERE d=6 AND a=6 AND c IN (1,2,3,4,5);
SELECT COUNT(*), SUM(a) FROM t1 WHERE d=6 AND a=6 AND c IN (1,2,3,4,5);
UPDATE t1 SET a=100 WHERE d=6 AND a=6 AND c IN (1,2,3,4,5);
SELECT COUNT(*), SUM(a) FROM t1 WHERE d=6 AND a=6 AND c IN (1,2,3,4,5);
EXPLAIN UPDATE t1 SET a=2 WHERE a=5 AND b=4 AND d<3;
UPDATE t1 SET a=2 WHERE a=5 AND b=4 AND d<3;
create table t2 ( pk MEDIUMINT NOT NULL AUTO_INCREMENT, a INT NOT NULL, b INT NOT NULL, c INT NOT NULL, d INT NOT NULL, PRIMARY KEY pk (pk), KEY idx_a (a), KEY idx_b (b), KEY idx_c (c), KEY idx_d (d) )engine=InnoDB;
INSERT INTO t2 SELECT * FROM t1;
ANALYZE TABLE t2;
EXPLAIN UPDATE t2 SET a=2 WHERE pk<2492 AND d<=1;
UPDATE t2 SET a=2 WHERE pk<2492 AND d<=1;
CREATE TABLE t3( a INT NOT NULL, b INT NOT NULL, c INT NOT NULL, d INT NOT NULL, e INT );
INSERT INTO t3(a,b,c,d,e) VALUES (3890,3890,3890,3890,3890);
INSERT INTO t3(a,b,c,d,e) VALUES (4000,4000,4000,4000,4000);
EXPLAIN REPLACE INTO t3 SELECT * FROM t1 WHERE b=6 AND c=6;
SELECT COUNT(*) FROM t3;
REPLACE INTO t3 SELECT * FROM t1 WHERE b=6 AND c=6;
SELECT COUNT(*) FROM t3;
EXPLAIN INSERT INTO t3 SELECT * FROM t1 WHERE d=6 AND a IS NOT NULL AND b=6;
SELECT COUNT(*) FROM t3;
INSERT INTO t3 SELECT * FROM t1 WHERE d=6 AND a IS NOT NULL AND b=6;
SELECT COUNT(*) FROM t3;
CREATE TABLE t4 ( pk MEDIUMINT NOT NULL AUTO_INCREMENT, a INT NOT NULL, b INT NOT NULL, c INT NOT NULL, d INT NOT NULL, PRIMARY KEY pk (pk), KEY idx_cd (c,d), KEY idx_bd (b,d) );
INSERT INTO t4 SELECT * FROM t1;
ANALYZE TABLE t4;
EXPLAIN UPDATE t4 SET a=2 WHERE b=6 AND c=6 AND d=6;
SELECT COUNT(*), SUM(a) FROM t4 WHERE b=6 AND c=6 AND d=6;
UPDATE t4 SET a=2 WHERE b=6 AND c=6 AND d=6;
SELECT COUNT(*), SUM(a)  FROM t4 WHERE b=6 AND c=6 AND d=6;
DROP TABLE t1,t2,t3,t4;
CREATE TABLE t(x INT, y INT, pk INT PRIMARY KEY, KEY(x), KEY(y));
INSERT INTO t VALUES (1,1,1), (3,3,2), (3,3,3), (4,4,4), (3,3,5), (4,4,6), (3,3,7), (8,8,8), (1,1,9), (3,3,10), (3,3,11), (4,4,12), (3,3,13), (4,4,14), (3,3,15), (8,8,16);
ANALYZE TABLE t;
EXPLAIN SELECT COUNT(*) FROM t WHERE x = 3 AND y = 4;;
SELECT COUNT(*) FROM t WHERE x = 3 AND y = 4;;
DROP TABLE t;
CREATE TABLE t1 (ID int, PRIMARY KEY (ID));
CREATE TABLE t2 (ID int, c1 int DEFAULT NULL, c2 int, PRIMARY KEY (ID), KEY c1_INDEX (c1), KEY c2_INDEX (c2));
insert into t1 values (1);
insert into t2 values (1,1,20),(2,1,20),(3,1,30),(4,2,30);
SELECT * FROM t1 WHERE t1.ID=1 AND EXISTS ( SELECT 1 FROM t2 WHERE t2.c2=30 AND t2.c1=t1.ID);
DROP TABLE t1;
DROP TABLE t2;
