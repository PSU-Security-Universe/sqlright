drop table if exists t0,t1,t2,t3,t4;
drop table if exists t0,t5,t6,t7,t8,t9,t1_1,t1_2,t9_1,t9_2;
create table t0 SELECT 1,"table 1";
create table t2 SELECT 2,"table 2";
create table t3 SELECT 3,"table 3";
rename table t0 to t1;
rename table t3 to t4, t2 to t3, t1 to t2, t4 to t1;
select * from t1;
rename table t3 to t4, t2 to t3, t1 to t2, t4 to t1;
rename table t3 to t4, t2 to t3, t1 to t2, t4 to t1;
select * from t1;
rename table t1 to t2;
rename table t1 to t1;
rename table t3 to t4, t2 to t3, t1 to t2, t4 to t2;
show tables like "t_";
rename table t3 to t1, t2 to t3, t1 to t2, t4 to t1;
rename table t3 to t4, t5 to t3, t1 to t2, t4 to t1;
select * from t1;
select * from t2;
select * from t3;
drop table if exists t1,t2,t3,t4;
CREATE TABLE t1 (a int);
CREATE TABLE t3 (a int);
FLUSH TABLES WITH READ LOCK;
RENAME TABLE t1 TO t2, t3 to t4;
show tables;
UNLOCK TABLES;
select * from t2, t4;
show tables;
drop table t2, t4;
create table t1(f1 int);
create view v1 as select * from t1;
alter table v1 rename to v2;
drop view v1;
drop table t1;
SET @orig_innodb_file_per_table= @@innodb_file_per_table;
SET GLOBAL innodb_file_per_table = 0;
create table t1(f1 int) engine=innodb;
rename table test.t1 to nonexistingdb.t2;
drop table t1;
SET GLOBAL innodb_file_per_table = @orig_innodb_file_per_table;
SET @old_lock_wait_timeout= @@lock_wait_timeout;
SET @old_lock_wait_timeout= @@lock_wait_timeout;
CREATE TABLE t1 (i INT);
CREATE TABLE t2 (j INT);
LOCK TABLES t1 READ;
RENAME TABLE t2 TO t3;
RENAME TABLE t1 TO t3;
UNLOCK TABLES;
LOCK TABLE t1 WRITE;
RENAME TABLE t1 TO t3;
RENAME TABLE t3 TO t4, t4 TO t5;
UNLOCK TABLES;
SET FOREIGN_KEY_CHECKS=0;
CREATE TABLE t1 (fk INT, FOREIGN KEY(fk) REFERENCES t3(pk));
SET FOREIGN_KEY_CHECKS=1;
CREATE TABLE t0 (pk INT PRIMARY KEY);
LOCK TABLES t0 WRITE;
RENAME TABLE t0 TO t3;
UNLOCK TABLES;
LOCK TABLES t1 READ, t0 WRITE;
RENAME TABLE t0 TO t3;
UNLOCK TABLES;
LOCK TABLES t1 WRITE, t0 WRITE;
RENAME TABLE t0 TO t3;
UNLOCK TABLES;
DROP TABLES t1, t3;
LOCK TABLES t5 WRITE;
RENAME TABLE t5 TO t4;
SELECT * FROM t4;
SET @@lock_wait_timeout= 1;
SELECT * FROM t4;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM t5;
UNLOCK TABLES;
LOCK TABLES t2 READ, t4 WRITE;
RENAME TABLE t4 TO t5;
SELECT * FROM t2;
INSERT INTO t5 values (1);
UNLOCK TABLES;
LOCK TABLES t2 READ, t5 WRITE, t5 AS a WRITE, t5 AS b READ;
RENAME TABLE t5 TO t4;
SELECT * FROM t4 AS a, t4 AS b;
INSERT INTO t4 VALUES (2);
DELETE a FROM t4 AS a, t4 AS b;
DELETE b FROM t4 AS a, t4 AS b;
UNLOCK TABLES;
LOCK TABLES t2 WRITE, t4 WRITE;
RENAME TABLES t2 TO t0, t4 TO t2, t0 TO t4;
SELECT * FROM t2;
SELECT * FROM t4;
SET @@lock_wait_timeout= 1;
SELECT * FROM t2;
SELECT * FROM t4;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM t0;
UNLOCK TABLES;
LOCK TABLE t2 WRITE;
RENAME TABLES t2 TO t1, t1 TO t3, t3 TO t5;
SELECT * FROM t5;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
SET @@lock_wait_timeout= 1;
SELECT * FROM t5;
SET @@lock_wait_timeout= @old_lock_wait_timeout;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t3;
UNLOCK TABLES;
CREATE TABLE t6(k INT);
LOCK TABLES t4 WRITE, t5 WRITE, t6 WRITE;
RENAME TABLES t4 TO t1, t5 TO t2;
SELECT * FROM t1;
SELECT * FROM t2;
SELECT * FROM t4;
SELECT * FROM t5;
SELECT * FROM t6;
SET @@lock_wait_timeout= 1;
SELECT * FROM t1;
SELECT * FROM t2;
