CREATE TABLE t (a INT, b INT, c INT, d INT, e INT, PRIMARY KEY(a, b, c, d), KEY(b, d)) ENGINE=innodb;
CREATE TEMPORARY TABLE a (a INT);
INSERT INTO a VALUES (10);
INSERT INTO a VALUES (9);
INSERT INTO a VALUES (8);
INSERT INTO a VALUES (7);
INSERT INTO a VALUES (6);
INSERT INTO a VALUES (5);
INSERT INTO a VALUES (4);
INSERT INTO a VALUES (3);
INSERT INTO a VALUES (2);
INSERT INTO a VALUES (1);
CREATE TEMPORARY TABLE b (a INT);
INSERT INTO b VALUES (5);
INSERT INTO b VALUES (4);
INSERT INTO b VALUES (3);
INSERT INTO b VALUES (2);
INSERT INTO b VALUES (1);
CREATE TEMPORARY TABLE c (a INT);
INSERT INTO c VALUES (5);
INSERT INTO c VALUES (4);
INSERT INTO c VALUES (3);
INSERT INTO c VALUES (2);
INSERT INTO c VALUES (1);
CREATE TEMPORARY TABLE d (a INT);
INSERT INTO d VALUES (10);
INSERT INTO d VALUES (9);
INSERT INTO d VALUES (8);
INSERT INTO d VALUES (7);
INSERT INTO d VALUES (6);
INSERT INTO d VALUES (5);
INSERT INTO d VALUES (4);
INSERT INTO d VALUES (3);
INSERT INTO d VALUES (2);
INSERT INTO d VALUES (1);
INSERT INTO t SELECT a.a, b.a, c.a, d.a, d.a FROM a, b, c, d ORDER BY a.a, b.a, c.a, d.a;
DROP TEMPORARY TABLE a, b, c, d;
ANALYZE TABLE t;
set optimizer_switch = 'skip_scan=on';
EXPLAIN SELECT b, d FROM t WHERE d < 2;
FLUSH STATUS;
SELECT b, d FROM t WHERE d < 2;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE skip_scan SELECT b, d FROM t WHERE d < 2;
set optimizer_switch = 'skip_scan=off';
EXPLAIN SELECT b, d FROM t WHERE d < 2;
FLUSH STATUS;
SELECT b, d FROM t WHERE d < 2;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE no_skip_scan SELECT b, d FROM t WHERE d < 2;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-skip_scan';;
set @@sort_buffer_size = @save_sbs;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.no_skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-no_skip_scan';;
set @@sort_buffer_size = @save_sbs;
EXPLAIN SELECT /*+ SKIP_SCAN(t) */ b, d FROM t WHERE d < 2;
FLUSH STATUS;
SELECT /*+ SKIP_SCAN(t) */ b, d FROM t WHERE d < 2;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE hint_skip_scan SELECT /*+ SKIP_SCAN(t) */ b, d FROM t WHERE d < 2;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.hint_skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-hint_skip_scan';;
set @@sort_buffer_size = @save_sbs;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.no_skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-no_skip_scan';;
set @@sort_buffer_size = @save_sbs;
DROP TABLE skip_scan, no_skip_scan, hint_skip_scan;
set optimizer_switch = 'skip_scan=on';
EXPLAIN SELECT b, d FROM t WHERE d > 4;
FLUSH STATUS;
SELECT b, d FROM t WHERE d > 4;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE skip_scan SELECT b, d FROM t WHERE d > 4;
set optimizer_switch = 'skip_scan=off';
EXPLAIN SELECT b, d FROM t WHERE d > 4;
FLUSH STATUS;
SELECT b, d FROM t WHERE d > 4;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE no_skip_scan SELECT b, d FROM t WHERE d > 4;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-skip_scan';;
set @@sort_buffer_size = @save_sbs;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.no_skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-no_skip_scan';;
set @@sort_buffer_size = @save_sbs;
EXPLAIN SELECT /*+ SKIP_SCAN(t) */ b, d FROM t WHERE d > 4;
FLUSH STATUS;
SELECT /*+ SKIP_SCAN(t) */ b, d FROM t WHERE d > 4;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE hint_skip_scan SELECT /*+ SKIP_SCAN(t) */ b, d FROM t WHERE d > 4;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.hint_skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-hint_skip_scan';;
set @@sort_buffer_size = @save_sbs;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.no_skip_scan ORDER BY `b`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-no_skip_scan';;
set @@sort_buffer_size = @save_sbs;
DROP TABLE skip_scan, no_skip_scan, hint_skip_scan;
set optimizer_switch = 'skip_scan=on';
EXPLAIN SELECT a, b, c, d FROM t WHERE a = 5 AND d <= 3;
FLUSH STATUS;
SELECT a, b, c, d FROM t WHERE a = 5 AND d <= 3;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE skip_scan SELECT a, b, c, d FROM t WHERE a = 5 AND d <= 3;
set optimizer_switch = 'skip_scan=off';
EXPLAIN SELECT a, b, c, d FROM t WHERE a = 5 AND d <= 3;
FLUSH STATUS;
SELECT a, b, c, d FROM t WHERE a = 5 AND d <= 3;
SHOW STATUS LIKE 'handler_read%';
CREATE TABLE no_skip_scan SELECT a, b, c, d FROM t WHERE a = 5 AND d <= 3;
set @save_sbs = @@sort_buffer_size;
set @@sort_buffer_size = 1048576;
SELECT * FROM test.skip_scan ORDER BY `a`,`b`,`c`,`d` INTO OUTFILE '/data/yu/Squirrel_DBMS_Fuzzing/MySQL_source/mysql-server-inst/bld/mysql-test/var/mysqld.1/data//diff_table--test-skip_scan';;
set @@sort_buffer_size = @save_sbs;
